import { ConnectingLine } from "./connectingLine.js";
import { DraggableCircle } from "./draggableCircle.js";
import { ClickableLock } from "./clickableLock.js";

document.addEventListener("DOMContentLoaded", function () {

    // make dynamic
    const circles=  [];
    const numCircles= 3;
    const boundsY = { lower: 40, upper: 700 };
    const initialX = 300
    const slope = -1

    makeHardCodedCircles_V2()
    makeIsopleths();

    function fetchAxisCoordsDict() {
        return fetch("axis_to_coord_values.json") // Fetch the JSON file
            .then((response) => {
                if (!response.ok) {
                    throw new Error("Failed to load JSON file");
                }
                return response.json(); // Parse the JSON file into a JavaScript object
            })
            .then((data) => {
                console.log("Loaded dictionary:", data); // Log the dictionary for debugging
                return data; // Return the dictionary
            })
            .catch((error) => {
                console.error("Error fetching JSON:", error);
            });
    }

    function createSVGContainer() {
        const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        svg.style.position = "absolute";
        svg.style.top = "0";
        svg.style.left = "0";
        svg.style.width = "500%";
        svg.style.height = "500%";
        svg.style.pointerEvents = "none";
        document.body.appendChild(svg);
        return svg;
    }

    createSVGContainer()
    fetchAxisCoordsDict().then((data) => {
        console.log("Fetched data:", data);
        // Use the fetched data here
    });
    
    //issue it stops at 5?? On inkspace it should stop at 440
    function makeHardCodedCircles_V1() {
        const newCircle = new DraggableCircle({
            initialPosition: { top: 15.12, left: 3.44 },
            bounds: {lower: 15.12, upper: 440},
            slope: Infinity
            
        });

    }
    function makeHardCodedCircles_V2() {
        const circleA = new DraggableCircle({
            initialPosition: { top: 15.82, left: 3.44 },
            bounds: {lower: 15.12, upper: 582},
            slope: Infinity
        });
        circles.push(circleA)

        // const diagonalTop = 80
        // const circleB = new DraggableCircle({
        //     initialPosition: { top: diagonalTop, left: 501 },
        //     bounds: {lower: diagonalTop, upper: 582},
        //     slope: -1
        // });
        // circles.push(circleB)

        const circleC = new DraggableCircle({
            initialPosition: { top: 15.12, left: 570 },
            bounds: {lower: 15.12, upper: 582},
            slope: Infinity
        });
        circles.push(circleC)


    }

    const axisCoordsMap = {
    "Axis 1": {"(6.1, 12.4)": "0.0", "(6.1, 15.3)": "0.1", "(6.1, 18.1)": "0.2", "(6.1, 20.9)": "0.3", "(6.1, 23.8)": "0.4", "(6.1, 26.6)": "0.5", "(6.1, 29.4)": "0.6", "(6.1, 32.3)": "0.7", "(6.1, 35.1)": "0.8", "(6.1, 37.9)": "0.9", "(6.1, 40.8)": "1.0", "(6.1, 43.6)": "1.1", "(6.1, 46.4)": "1.2", "(6.1, 49.3)": "1.3", "(6.1, 52.1)": "1.4", "(6.1, 54.9)": "1.5", "(6.1, 57.8)": "1.6", "(6.1, 60.6)": "1.7", "(6.1, 63.4)": "1.8", "(6.1, 66.3)": "1.9", "(6.1, 69.1)": "2.0", "(6.1, 71.9)": "2.1", "(6.1, 74.8)": "2.2", "(6.1, 77.6)": "2.3", "(6.1, 80.4)": "2.4", "(6.1, 83.3)": "2.5", "(6.1, 86.1)": "2.6", "(6.1, 88.9)": "2.7", "(6.1, 91.8)": "2.8", "(6.1, 94.6)": "2.9", "(6.1, 97.5)": "3.0", "(6.1, 100.3)": "3.1", "(6.1, 103.1)": "3.2", "(6.1, 106.0)": "3.3", "(6.1, 108.8)": "3.4", "(6.1, 111.6)": "3.5", "(6.1, 114.5)": "3.6", "(6.1, 117.3)": "3.7", "(6.1, 120.1)": "3.8", "(6.1, 123.0)": "3.9", "(6.1, 125.8)": "4.0", "(6.1, 128.6)": "4.1", "(6.1, 131.5)": "4.2", "(6.1, 134.3)": "4.3", "(6.1, 137.1)": "4.4", "(6.1, 140.0)": "4.5", "(6.1, 142.8)": "4.6", "(6.1, 145.6)": "4.7", "(6.1, 148.5)": "4.8", "(6.1, 151.3)": "4.9", "(6.1, 154.1)": "5.0", "(6.1, 157.0)": "5.1", "(6.1, 159.8)": "5.2", "(6.1, 162.6)": "5.3", "(6.1, 165.5)": "5.4", "(6.1, 168.3)": "5.5", "(6.1, 171.1)": "5.6", "(6.1, 174.0)": "5.7", "(6.1, 176.8)": "5.8", "(6.1, 179.6)": "5.9", "(6.1, 182.5)": "6.0", "(6.1, 185.3)": "6.1", "(6.1, 188.1)": "6.2", "(6.1, 191.0)": "6.3", "(6.1, 193.8)": "6.4", "(6.1, 196.6)": "6.5", "(6.1, 199.5)": "6.6", "(6.1, 202.3)": "6.7", "(6.1, 205.1)": "6.8", "(6.1, 208.0)": "6.9", "(6.1, 210.8)": "7.0", "(6.1, 213.7)": "7.1", "(6.1, 216.5)": "7.2", "(6.1, 219.3)": "7.3", "(6.1, 222.2)": "7.4", "(6.1, 225.0)": "7.5", "(6.1, 227.8)": "7.6", "(6.1, 230.7)": "7.7", "(6.1, 233.5)": "7.8", "(6.1, 236.3)": "7.9", "(6.1, 239.2)": "8.0", "(6.1, 242.0)": "8.1", "(6.1, 244.8)": "8.2", "(6.1, 247.7)": "8.3", "(6.1, 250.5)": "8.4", "(6.1, 253.3)": "8.5", "(6.1, 256.2)": "8.6", "(6.1, 259.0)": "8.7", "(6.1, 261.8)": "8.8", "(6.1, 264.7)": "8.9", "(6.1, 267.5)": "9.0", "(6.1, 270.3)": "9.1", "(6.1, 273.2)": "9.2", "(6.1, 276.0)": "9.3", "(6.1, 278.8)": "9.4", "(6.1, 281.7)": "9.5", "(6.1, 284.5)": "9.6", "(6.1, 287.3)": "9.7", "(6.1, 290.2)": "9.8", "(6.1, 293.0)": "9.9", "(6.1, 295.8)": "10.0"}, 
    "Axis 2": {"(147.8, 154.1)": "10.0", "(147.8, 155.5)": "9.9", "(147.8, 156.9)": "9.8", "(147.8, 158.4)": "9.7", "(147.8, 159.8)": "9.6", "(147.8, 161.2)": "9.5", "(147.8, 162.6)": "9.4", "(147.8, 164.0)": "9.3", "(147.8, 165.4)": "9.2", "(147.8, 166.9)": "9.1", "(147.8, 168.3)": "9.0", "(147.8, 169.7)": "8.9", "(147.8, 171.1)": "8.8", "(147.8, 172.5)": "8.7", "(147.8, 173.9)": "8.6", "(147.8, 175.4)": "8.5", "(147.8, 176.8)": "8.4", "(147.8, 178.2)": "8.3", "(147.8, 179.6)": "8.2", "(147.8, 181.0)": "8.1", "(147.8, 182.4)": "8.0", "(147.8, 183.9)": "7.9", "(147.8, 185.3)": "7.8", "(147.8, 186.7)": "7.7", "(147.8, 188.1)": "7.6", "(147.8, 189.5)": "7.5", "(147.8, 191.0)": "7.4", "(147.8, 192.4)": "7.3", "(147.8, 193.8)": "7.2", "(147.8, 195.2)": "7.1", "(147.8, 196.6)": "7.0", "(147.8, 198.0)": "6.9", "(147.8, 199.5)": "6.8", "(147.8, 200.9)": "6.7", "(147.8, 202.3)": "6.6", "(147.8, 203.7)": "6.5", "(147.8, 205.1)": "6.4", "(147.8, 206.5)": "6.3", "(147.8, 208.0)": "6.2", "(147.8, 209.4)": "6.1", "(147.8, 210.8)": "6.0", "(147.8, 212.2)": "5.9", "(147.8, 213.6)": "5.8", "(147.8, 215.0)": "5.7", "(147.8, 216.5)": "5.6", "(147.8, 217.9)": "5.5", "(147.8, 219.3)": "5.4", "(147.8, 220.7)": "5.3", "(147.8, 222.1)": "5.2", "(147.8, 223.5)": "5.1", "(147.8, 225.0)": "5.0", "(147.8, 226.4)": "4.9", "(147.8, 227.8)": "4.8", "(147.8, 229.2)": "4.7", "(147.8, 230.6)": "4.6", "(147.8, 232.0)": "4.5", "(147.8, 233.5)": "4.4", "(147.8, 234.9)": "4.3", "(147.8, 236.3)": "4.2", "(147.8, 237.7)": "4.1", "(147.8, 239.1)": "4.0", "(147.8, 240.6)": "3.9", "(147.8, 242.0)": "3.8", "(147.8, 243.4)": "3.7", "(147.8, 244.8)": "3.6", "(147.8, 246.2)": "3.5", "(147.8, 247.6)": "3.4", "(147.8, 249.1)": "3.3", "(147.8, 250.5)": "3.2", "(147.8, 251.9)": "3.1", "(147.8, 253.3)": "3.0", "(147.8, 254.7)": "2.9", "(147.8, 256.1)": "2.8", "(147.8, 257.6)": "2.7", "(147.8, 259.0)": "2.6", "(147.8, 260.4)": "2.5", "(147.8, 261.8)": "2.4", "(147.8, 263.2)": "2.3", "(147.8, 264.6)": "2.2", "(147.8, 266.1)": "2.1", "(147.8, 267.5)": "2.0", "(147.8, 268.9)": "1.9", "(147.8, 270.3)": "1.8", "(147.8, 271.7)": "1.7", "(147.8, 273.1)": "1.6", "(147.8, 274.6)": "1.5", "(147.8, 276.0)": "1.4", "(147.8, 277.4)": "1.3", "(147.8, 278.8)": "1.2", "(147.8, 280.2)": "1.1", "(147.8, 281.6)": "1.0", "(147.8, 283.1)": "0.9", "(147.8, 284.5)": "0.8", "(147.8, 285.9)": "0.7", "(147.8, 287.3)": "0.6", "(147.8, 288.7)": "0.5", "(147.8, 290.1)": "0.4", "(147.8, 291.6)": "0.3", "(147.8, 293.0)": "0.2", "(147.8, 294.4)": "0.1", "(147.8, 295.8)": "0.0"},
    "Axis 3": {"(289.5, 12.4)": "-10.0", "(289.5, 15.2)": "-9.9", "(289.5, 18.0)": "-9.8", "(289.5, 20.9)": "-9.7", "(289.5, 23.7)": "-9.6", "(289.5, 26.5)": "-9.5", "(289.5, 29.4)": "-9.4", "(289.5, 32.2)": "-9.3", "(289.5, 35.1)": "-9.2", "(289.5, 37.9)": "-9.1", "(289.5, 40.7)": "-9.0", "(289.5, 43.6)": "-8.9", "(289.5, 46.4)": "-8.8", "(289.5, 49.2)": "-8.7", "(289.5, 52.1)": "-8.6", "(289.5, 54.9)": "-8.5", "(289.5, 57.7)": "-8.4", "(289.5, 60.6)": "-8.3", "(289.5, 63.4)": "-8.2", "(289.5, 66.2)": "-8.1", "(289.5, 69.1)": "-8.0", "(289.5, 71.9)": "-7.9", "(289.5, 74.7)": "-7.8", "(289.5, 77.6)": "-7.7", "(289.5, 80.4)": "-7.6", "(289.5, 83.2)": "-7.5", "(289.5, 86.1)": "-7.4", "(289.5, 88.9)": "-7.3", "(289.5, 91.7)": "-7.2", "(289.5, 94.6)": "-7.1", "(289.5, 97.4)": "-7.0", "(289.5, 100.2)": "-6.9", "(289.5, 103.1)": "-6.8", "(289.5, 105.9)": "-6.7", "(289.5, 108.7)": "-6.6", "(289.5, 111.6)": "-6.5", "(289.5, 114.4)": "-6.4", "(289.5, 117.2)": "-6.3", "(289.5, 120.1)": "-6.2", "(289.5, 122.9)": "-6.1", "(289.5, 125.7)": "-6.0", "(289.5, 128.6)": "-5.9", "(289.5, 131.4)": "-5.8", "(289.5, 134.2)": "-5.7", "(289.5, 137.1)": "-5.6", "(289.5, 139.9)": "-5.5", "(289.5, 142.7)": "-5.4", "(289.5, 145.6)": "-5.3", "(289.5, 148.4)": "-5.2", "(289.5, 151.2)": "-5.1", "(289.5, 154.1)": "-5.0", "(289.5, 156.9)": "-4.9", "(289.5, 159.8)": "-4.8", "(289.5, 162.6)": "-4.7", "(289.5, 165.4)": "-4.6", "(289.5, 168.3)": "-4.5", "(289.5, 171.1)": "-4.4", "(289.5, 173.9)": "-4.3", "(289.5, 176.8)": "-4.2", "(289.5, 179.6)": "-4.1", "(289.5, 182.4)": "-4.0", "(289.5, 185.3)": "-3.9", "(289.5, 188.1)": "-3.8", "(289.5, 190.9)": "-3.7", "(289.5, 193.8)": "-3.6", "(289.5, 196.6)": "-3.5", "(289.5, 199.4)": "-3.4", "(289.5, 202.3)": "-3.3", "(289.5, 205.1)": "-3.2", "(289.5, 207.9)": "-3.1", "(289.5, 210.8)": "-3.0", "(289.5, 213.6)": "-2.9", "(289.5, 216.4)": "-2.8", "(289.5, 219.3)": "-2.7", "(289.5, 222.1)": "-2.6", "(289.5, 224.9)": "-2.5", "(289.5, 227.8)": "-2.4", "(289.5, 230.6)": "-2.3", "(289.5, 233.4)": "-2.2", "(289.5, 236.3)": "-2.1", "(289.5, 239.1)": "-2.0", "(289.5, 241.9)": "-1.9", "(289.5, 244.8)": "-1.8", "(289.5, 247.6)": "-1.7", "(289.5, 250.4)": "-1.6", "(289.5, 253.3)": "-1.5", "(289.5, 256.1)": "-1.4", "(289.5, 258.9)": "-1.3", "(289.5, 261.8)": "-1.2", "(289.5, 264.6)": "-1.1", "(289.5, 267.4)": "-1.0", "(289.5, 270.3)": "-0.9", "(289.5, 273.1)": "-0.8", "(289.5, 276.0)": "-0.7", "(289.5, 278.8)": "-0.6", "(289.5, 281.6)": "-0.5", "(289.5, 284.5)": "-0.4", "(289.5, 287.3)": "-0.3", "(289.6, 290.1)": "-0.2", "(289.6, 293.0)": "-0.1", "(289.6, 295.8)": "0.0"}
}


    function makeCircles() {
        for (let c= 0; c< numCircles; c++){
            
            axisKey = "Axis " + c // "Axis 1"
            coordsMap = axisCoordsMap[axisKey] // {"(x,y)" : "val"}
            

            const newCircle = new DraggableCircle({
                initialPosition: { top: initialX, left: 50 + c*150 },
                bounds: boundsY,
                slope: slope
            });
            circles.push(newCircle)
        }
    }
    function makeIsopleths() {
        for (let i = 0; i< numCircles-1; i++ ){
            const connectingLine = new ConnectingLine ({
                circle1: circles[i],
                circle2: circles[i+1],
                opacity: "1"
            })
            circles[i].next_line = connectingLine
            circles[i+1].prev_line = connectingLine
        }
    }

    // lock: calc x midpoint b/w axes.
    // if vertical: (M_x, y_end + c)
    // if horizontal: (M_x, M_y +c)
    // if diagonal: (M_x, M_y + 2c)
}
);



document.addEventListener("DOMContentLoaded", function () {
    let verticalLockIncrement = 50;
    let horizontalLockIncrement = 10;

    function makeLock(x1, y1, x2, y2) {
        let midX = (x1 + x2) / 2;
        let midY = (y1 + y2) / 2;
        let lockPosition;
        
        if ((x1 - x2) === 0 || (y1 - y2) === 0) { // vertical/horizontal
            lockPosition = { left: midX + "px", top: y2 + verticalLockIncrement + "px" };
        } else {
            lockPosition = { left: midX + horizontalLockIncrement + "px", top: midY + 2 * verticalLockIncrement + "px" };
        }
        
        new ClickableLock({ position: lockPosition });
    }

    makeLock(570, 15, 570, 582);
});
    // const lockPositions = [
    //     { left: 5+ horizontalLockIncrement, top: 582 + verticalLockIncrement },
    //     { left: 250 + 2*horizontalLockIncrement,  top: 330 +1.5*verticalLockIncrement },
    //     { left: 570, top: 582 + 0.5*verticalLockIncrement}
    // ];
    
    // lockPositions.forEach(position => {
    //     new ClickableLock({ position });
    // });